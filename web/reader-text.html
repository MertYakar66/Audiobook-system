<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0d1117">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Scriptum - Reader</title>
    <link rel="stylesheet" href="reader-text.css">
</head>

<body>
    <div id="app">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <a href="library.html" class="back-btn" title="Back to Library">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
                        <line x1="19" y1="12" x2="5" y2="12" />
                        <polyline points="12 19 5 12 12 5" />
                    </svg>
                </a>
                <div class="header-info">
                    <h1 id="book-title">Loading...</h1>
                    <span id="book-author"></span>
                </div>
            </div>
            <div class="header-right">
                <button id="highlights-btn" class="header-btn" title="Highlights & Notes">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
                        <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z" />
                    </svg>
                </button>
                <button id="settings-btn" class="header-btn" title="Settings">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
                        <circle cx="12" cy="12" r="3" />
                        <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" />
                    </svg>
                </button>
            </div>
        </header>

        <!-- Chapter Navigation -->
        <nav class="chapter-nav">
            <button id="prev-chapter" class="chapter-btn" disabled>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                    <polyline points="15 18 9 12 15 6" />
                </svg>
                Previous
            </button>
            <select id="chapter-select"></select>
            <button id="next-chapter" class="chapter-btn" disabled>
                Next
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                    <polyline points="9 18 15 12 9 6" />
                </svg>
            </button>
        </nav>

        <!-- Main Content -->
        <main class="reader-content" id="reader-content">
            <!-- Loading State -->
            <div id="loading-state" class="state-view">
                <div class="loader"></div>
                <p>Loading book...</p>
            </div>

            <!-- Error State -->
            <div id="error-state" class="state-view" style="display: none;">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" width="48" height="48">
                    <circle cx="12" cy="12" r="10" />
                    <line x1="15" y1="9" x2="9" y2="15" />
                    <line x1="9" y1="9" x2="15" y2="15" />
                </svg>
                <h2>Could not load book</h2>
                <p id="error-message">An error occurred while loading the document.</p>
                <a href="library.html" class="primary-btn">Back to Library</a>
            </div>

            <!-- Reader View -->
            <article id="text-view" class="text-view" style="display: none;">
                <!-- Chapter content rendered here -->
            </article>
        </main>

        <!-- Reading Progress Bar -->
        <div class="reading-progress">
            <div id="reading-progress-fill" class="reading-progress-fill"></div>
        </div>

        <!-- Highlight Toolbar (appears on text selection) -->
        <div id="selection-toolbar" class="selection-toolbar" style="display: none;">
            <button class="highlight-color" data-color="yellow" style="background: #fff59d;" title="Yellow"></button>
            <button class="highlight-color" data-color="green" style="background: #c8e6c9;" title="Green"></button>
            <button class="highlight-color" data-color="blue" style="background: #bbdefb;" title="Blue"></button>
            <button class="highlight-color" data-color="pink" style="background: #f8bbd9;" title="Pink"></button>
            <button class="highlight-color" data-color="orange" style="background: #ffcc80;" title="Orange"></button>
            <div class="toolbar-divider"></div>
            <button id="add-note-btn" class="toolbar-btn" title="Add Note">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                    <polyline points="14 2 14 8 20 8" />
                    <line x1="12" y1="18" x2="12" y2="12" />
                    <line x1="9" y1="15" x2="15" y2="15" />
                </svg>
            </button>
        </div>

        <!-- Highlights/Notes Side Panel -->
        <div id="highlights-panel" class="side-panel">
            <div class="panel-content">
                <div class="panel-header">
                    <h2>Highlights & Notes</h2>
                    <button id="close-highlights" class="close-panel-btn">&times;</button>
                </div>
                <div id="highlights-list" class="highlights-list">
                    <p class="empty-message">No highlights yet. Select text to highlight.</p>
                </div>
            </div>
        </div>

        <!-- Note Modal -->
        <div id="note-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Add Note</h2>
                    <button id="close-note-modal" class="close-modal-btn">&times;</button>
                </div>
                <div id="note-preview" class="note-preview"></div>
                <textarea id="note-input" placeholder="Write your note..."></textarea>
                <div class="modal-actions">
                    <button id="save-note" class="primary-btn">Save Note</button>
                    <button id="highlight-only" class="secondary-btn">Highlight Only</button>
                </div>
            </div>
        </div>

        <!-- Settings Panel -->
        <div id="settings-panel" class="settings-panel" style="display: none;">
            <div class="settings-content">
                <div class="settings-header">
                    <h2>Settings</h2>
                    <button id="close-settings" class="close-panel-btn">&times;</button>
                </div>
                <div class="setting-group">
                    <label>Font Size</label>
                    <div class="font-size-controls">
                        <button id="font-decrease">A-</button>
                        <span id="font-size-value">18px</span>
                        <button id="font-increase">A+</button>
                    </div>
                </div>
                <div class="setting-group">
                    <label>Theme</label>
                    <div class="theme-options">
                        <button data-theme="dark" class="theme-btn active">Dark</button>
                        <button data-theme="light" class="theme-btn">Light</button>
                        <button data-theme="sepia" class="theme-btn">Sepia</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Toast -->
        <div id="toast" class="toast"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <script src="reader-text.js"></script>
</body>

</html>
